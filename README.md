<h1 align="center">API атом чата</h1>

<h2 align="left">Описание проекта</h2>

Этот проект представляет собой веб-приложение на основе фреймворка Django с использованием асинхронных функций 
(Django Channels) и Redis. Приложение предоставляет API для управления сущностями 
(например, пользователями, объектами и т.д.) с помощью REST API, защищённого с использованием JWT-токенов.

<h2 align="left">Технологии</h2>

1. Python 3.11 
2. Django 5.1.3 
3. Django REST Framework (DRF)
4. Django Channels 
5. Redis 
6. Docker и Docker Compose

<h2 align="left">Установка и запуск</h2>

**1. Предварительные требования:** установлен Docker.

**2. Склонируйте репозиторий на свою локальную машину:**

```
git clone <URL репозитория>
```

**3. Запустите и перейдите в корень проекта:**

```
cd atom_chat
```

**4. Соберите и запустите контейнеры:**

```
docker.exe compose -f docker-compose.yml -p atom_chat up --force-recreate -d --build
```

**5. Проверьте доступность сервиса:** когда контейнеры запустятся, Backend Django будет доступен 
по адресу: http://localhost:8000.

<h3 align="left">Инструкция для проверки запросов через Postman:</h3>

**1. Открыть Postman.**

**2. Создать необходимый запрос:** нажмите на вкладку "New" и выберите метод запроса.

**3. Введите URL-адрес.**

**4. Добавьте заголовки (Headers):** если ваш API требует заголовков, то их необходимо добавить, для этого перейдите на 
вкладку Headers.

**5. Добавьте тело запроса (Body):** перейдите на вкладку Body и добавьте тело запроса, если это необходимо.

**6. Отправьте запрос:** нажмите кнопку Send.

Если запрос успешен, вы получите ответ с кодом 200/201 и информацией.
Если произошла ошибка (например, 400 или 500), прочитайте описание ошибки.

----

<h3 align="left">Примеры запросов:</h3>

***1. Регистрация пользователя:***

1.1 Выберите метод запроса POST. Введите URL-адрес:

```
http://localhost:8000/api/register/
```

1.2 Добавьте следующий заголовок:

```
Key: Content-Type          
Value: application/json
```

1.3 Добавьте тело запроса:

Укажите данные пользователя в формате JSON, например:

```json
{
    "username": "new_user",
    "email": "new_user@example.com",
    "password": "password"
}
```

1.4 Отправьте запрос. Если запрос успешен, вы получите ответ с кодом 201 и информацией о зарегистрированном пользователе:

```json
{
    "Уведомление": "Пользователь успешно зарегистрирован"
}
```

Если произошла ошибка (например, 400 или 500), прочитайте описание ошибки.

<!-------------------------------------------------------------------------------------------------------------------->

***2. Аутентификация***

2.1 Выберите метод запроса POST. Введите URL-адрес:

```
http://localhost:8000/api/login/
```

2.2 Добавьте следующий заголовок:

```
Key: Content-Type            
Value: application/json
```

2.3 Добавьте тело запроса:

Укажите данные пользователя в формате JSON, например:

```json
{
    "username": "new_user",
    "password": "password"
}
```

2.4 Отправьте запрос. Если запрос успешен, вы получите ответ с кодом 200 и токенами:

```json
{
    "refresh": "<токен обновления>",
    "access": "<токен доступа>"
}
```

Если произошла ошибка (например, 400 или 500), прочитайте описание ошибки.

<!-------------------------------------------------------------------------------------------------------------------->

***3. Получение списка каналов***

3.1 Выберите метод запроса GET. Введите URL-адрес:

```
http://localhost:8000/api/channels/
```

3.2 Добавьте следующие заголовки:

```
Key: Content-Type            
Value: application/json

Key: Authorization            
Value: Bearer <Ваш токен доступа>
```

3.3 Отправьте запрос. Если запрос успешен, вы получите ответ с кодом 200 и информацией о доступных каналах:

```json
[
    {
        "id": 1,
        "name": "old_channel",
        "description": "Древний чат",
        "created_at": "2024-11-28T20:23:43.923942Z"
    },
    {
        "id": 13,
        "name": "Superuser_Channel",
        "description": "Канал создан суперпользователем",
        "created_at": "2024-12-01T13:45:11.797813Z"
    }
]
```

Если произошла ошибка (например, 400 или 500), прочитайте описание ошибки.

<!-------------------------------------------------------------------------------------------------------------------->

***4. Отправка сообщения в канал***

4.1 Нажмите на вкладку "New" и выберите WebSocket. Введите URL:

```
ws://127.0.0.1:8000/ws/chat/<channel_name>/
```

4.2 Добавьте следующий заголовок:

```
Key: Authorization            
Value: Bearer <Ваш токен доступа>
```

4.3 Нажмите кнопку Connect.

Если соединение установилось, вы получите следующее:
```
Connected to ws://127.0.0.1:8000/ws/chat/<channel_name>/
```

Если произошла ошибка (например, 400 или 500), прочитайте описание ошибки.

4.4 Добавьте тело запроса:

Укажите сообщение в формате JSON, например:

```json
{
    "message": "Ну, здравствуйте, я обычный пользователь)"
}
```

4.5. Нажмите кнопку Send.

Если сообщение отправилось, вы получите написанное Вами сообщение:

```json
{ "message": "Ну, здравствуйте, я обычный пользователь)"  }
```

Если произошла ошибка (например, 400 или 500), прочитайте описание ошибки.

4.6. Нажмите кнопку Disconnect. 

Если соединение разорвалось, вы получите следующее:

```
Disconnected from ws://127.0.0.1:8000/ws/chat/<channel_name>/
```

Если произошла ошибка (например, 400 или 500), прочитайте описание ошибки.

<!-------------------------------------------------------------------------------------------------------------------->

***5. Получение истории канала***

5.1 Выберите метод запроса GET. Введите URL-адрес:

```
http://localhost:8000/api/channels/<channel_identifier>/history/
```

5.2 Добавьте следующие заголовки:

```
Key: Content-Type            
Value: application/json

Key: Authorization            
Value: Bearer <Ваш токен доступа>
```

5.3 Отправьте запрос. Если запрос успешен, вы получите ответ с кодом 200 и информацией об истории канала:

```json
[
    {
        "id": 6,
        "user": "new_user",
        "content": "Ну, здравствуйте, я обычный пользователь)",
        "timestamp": "2024-12-01T14:07:33.784960Z"
    },
    {
        "id": 7,
        "user": "admin",
        "content": "привет привет",
        "timestamp": "2024-12-01T16:21:01.455407Z"
    }
]
```

Если произошла ошибка (например, 400 или 500), прочитайте описание ошибки.

----

**Для модераторов и суперпользователей доступен следующий функционал:**

1. Создание канала.
2. Обновление названия и/или описания канала.
3. Удаление канала.

**Для модераторов также доступно:**
1. Просмотр всех пользователей (кроме других модераторов и суперпользователей).
2. Изменение статуса блокировки пользователя (кроме других модераторов и суперпользователей).

**Для суперпользователей также доступно:**
1. Просмотр всех пользователей.
2. Изменение статуса блокировки пользователя.
3. Назначение модераторов.

P.S. Учетная запись с правами суперпользователя:
```
username: "admin" password: "admin123"
```
Учетная запись с правами модератора:
```
username: "user1" password: "1"
```

----

Реализованы unit-тесты основных методов API.
Тесты находятся в atom_chat\backend\chat\tests.py.

Чтобы запустить тесты, необходимо выполнить следующую команду из корня проекта:
```
docker-compose run backend python manage.py test
```
